name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v1
    - name: cd service
      run: cd service
    - uses: azure/actions/login@master
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}   
    - run: |
        az webapp list --query "[?state=='Running']"
    - uses: actions/docker/login@master
      env:
        DOCKER_REGISTRY_URL: ${{ secrets.DOCKER_REGISTRY_URL }}
        DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
        DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
    - uses: actions/docker/cli@master
      with:
        args: build --tag live-share-can .
    - uses: actions/docker/cli@master
      with:
        args: tag live-share-can vslsCommunitiesRegistry.azurecr.io/live-share-can:v0.1.0
    - uses: actions/docker/cli@master
      with:
        args: push vslsCommunitiesRegistry.azurecr.io/live-share-can:v0.1.0
