name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v1
    - name: cd service
      run: cd service
    - uses: azure/actions/login@master
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}   
    - run: |
        az webapp list --query "[?state=='Running']"
    - uses: pangzineng/Github-Action-One-Click-Docker@master
      with:
        args: service
      env:
        DOCKER_REGISTRY_URL: ${{ secrets.DOCKER_REGISTRY_URL }}
        DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
        DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
        DOCKER_IMAGE_NAME: live-share-can
        DOCKER_IMAGE_TAG: v0.2.0
#     - uses: actions/docker/cli@master
#       with:
#         args: build --tag live-share-can service
#     - uses: actions/docker/cli@master
#       with:
#         args: tag live-share-can vslsCommunitiesRegistry.azurecr.io/live-share-can:v0.1.0
#     - uses: actions/docker/cli@master
#       with:
#         args: push vslsCommunitiesRegistry.azurecr.io/live-share-can:v0.1.0
