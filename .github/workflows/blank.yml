name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v1
    - name: cd service
      run: cd service
    - uses: azure/actions/login@master
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}   
    - run: |
        az webapp list --query "[?state=='Running']"
    - uses: pangzineng/Github-Action-One-Click-Docker@master
      with:
        args: service
      env:
        DOCKER_REGISTRY_URL: ${{ secrets.DOCKER_REGISTRY_URL }}
        DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
        DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
        DOCKER_IMAGE_NAME: live-share-can
        DOCKER_NAMESPACE: ''
        DOCKER_IMAGE_TAG: v0.2.0
